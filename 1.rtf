{\rtf1\ansi\ansicpg1252\cocoartf2638
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue-Bold;\f1\fnil\fcharset0 HelveticaNeue;}
{\colortbl;\red255\green255\blue255;\red220\green161\blue13;}
{\*\expandedcolortbl;;\cssrgb\c89412\c68627\c3922;}
\paperw11900\paperh16840\margl1440\margr1440\vieww29740\viewh15940\viewkind0
\deftab560
\pard\pardeftab560\partightenfactor0

\f0\b\fs40 \cf0 Doco for project\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0

\f1\b0\fs26 \cf0 \
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 Create user pod identity\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 Repos\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 Digital iac\
Key vault\
Main\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 Remove secret and access policies\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 In iac , I need to add key vault\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 ==\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
\
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 Moving the env from integration team to channel service\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
\
\pard\pardeftab560\slleading20\partightenfactor0
\cf0 Build the framework ready, go to tech lead,  input from dev team what parameters needs to be configured.\
\
=======\
/subscriptions/5da8013f-6883-4e0b-8de5-90141e2a60df/resourceGroups/RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_DEV_AUE/providers/Microsoft.DocumentDB/databaseAccounts/db-acc-product-list-platform-service-dev\
\
RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_DEV_AUE\
\
\
/subscriptions/5da8013f-6883-4e0b-8de5-90141e2a60df/resourceGroups/RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_DEV_AUE/providers/Microsoft.Network/virtualNetworks/VNET_DGXP_PRIVATE_NONPROD_AUE",\
==========\
\
"/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_NONPROD_AUE/subnets/SUBNET_INTEGRATION_KUBE_KUBE-SHARED_NONPROD_AUE",\
\
        "/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_NONPROD_AUE/subnets/SUBNET_INTEGRATION_KUBERNETES_KUBE-SHARED_NONPROD_AUE",\
\
        "/subscriptions/889e3e4d-0562-4125-b2de-3bdf18ee7c09/resourceGroups/RG_Cloud_Services_Non-Production_AUE/providers/Microsoft.Network/virtualNetworks/VNET_CLOUD_SERVICES_PRIVATE_NONPRODUCTION_AUE/subnets/SUBNET_DEVOPS_AGENTS_PRIVATE_DEV_AUE",\
\
        "/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUS/providers/Microsoft.Network/virtualNetworks/VNET_INTE_BASE_PRIVATE_NONPROD_AUS/subnets/SUBNET_INTEGRATION_KUBE_KUBE-SHARED_NONPROD_AUS"\
\
\
\
===\
\
\
#args: ["-c", "echo test" ]\
        # args: ["-c", "exec java $JAVA_OPTS -Djava.security.egd=file:/dev/./urandom -jar /app.jar $JAR_OPTS"]\
        # args: ["-c", "exec java -Dspring.profiles.active=dev -Xmx1024M -Xms512M -server -XX:+UseG1GC -Djava.security.egd=file:/dev/./urandom -jar /app.jar --spring.config.additional-location=/app/application-dev.properties"]\
===\
SIT json\
\
\{\
    "environment": "sit",\
    "location": "australiaeast",\
    "rg_name": "RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_SIT_AUE",\
    "cosmosdb_offer_type": "Standard",\
    "cosmosdb_throughput": 400,\
    "private_endpoint_subnet_id": "/subscriptions/5da8013f-6883-4e0b-8de5-90141e2a60df/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_DGXP_PRIVATE_NONPROD_AUE/subnets/SUBNET_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCT_LIST_SUBNET_SIT_AUE",\
    "active_directory_admin_group_object_id": "ecd98082-58c0-47ec-8f76-e7fd30c0fd41",\
    "allowed_subnets": [\
        "/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_NONPROD_AUE/subnets/SUBNET_INTEGRATION_KUBE_KUBE-SHARED_NONPROD_AUE",\
        "/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_NONPROD_AUE/subnets/SUBNET_INTEGRATION_KUBERNETES_KUBE-SHARED_NONPROD_AUE",\
        "/subscriptions/889e3e4d-0562-4125-b2de-3bdf18ee7c09/resourceGroups/RG_Cloud_Services_Non-Production_AUE/providers/Microsoft.Network/virtualNetworks/VNET_CLOUD_SERVICES_PRIVATE_NONPRODUCTION_AUE/subnets/SUBNET_DEVOPS_AGENTS_PRIVATE_DEV_AUE",\
        "/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUS/providers/Microsoft.Network/virtualNetworks/VNET_INTE_BASE_PRIVATE_NONPROD_AUS/subnets/SUBNET_INTEGRATION_KUBE_KUBE-SHARED_NONPROD_AUS"\
\
    ],\
    "service_client_id": "ac9d397f-619f-45d6-b5bc-57b405b2ee90"\
\}\
\
\
\
\pard\pardeftab560\slleading20\partightenfactor0

\f0\b \cf0 SPN-Coles-DEV-DigitalExperience-CSV-API-PRODUCT-LIST-SERVICE  -  6062bcd4-012b-467c-84c4-f414e65e1c3e\
SPN-Coles-SIT-DigitalExperience-CSV-API-PRODUCT-LIST-SERVICE - 40e5723a-6037-4eec-9539-6481b2b33845\
\
\pard\pardeftab560\slleading20\partightenfactor0

\f1\b0 \cf0 Error: Error making Read request on Azure KeyVault Secret azure-cosmosdb-key: keyvault.BaseClient#GetSecret: Failure responding to request: StatusCode=403 -- Original Error: autorest/azure: Service returned an error. Status=403 Code="Forbidden" Message="Client address is not authorized and caller is not a trusted service.\\r\\nClient address: 10.12.0.184 from unknown subnet\\r\\nCaller: appid=***;oid=3561a769-1009-4e07-9286-366621543e51;iss={\field{\*\fldinst{HYPERLINK "https://sts.windows.net/82551a12-bbc8-4fed-8b7f-2b758284b5ea//r/nVault"}}{\fldrslt \cf2 \ul \ulc2 https://sts.windows.net/82551a12-bbc8-4fed-8b7f-2b758284b5ea/\\r\\nVault}}: KV-PRODUCT-LIST-SIT;location=australiaeast" InnerError=\{"code":"ForbiddenByFirewall"\}\
\
==\
\
"/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_NONPROD_AUE/subnets/SUBNET_INTEGRATION_KUBE_KUBE-SHARED_NONPROD_AUE",\
        "/subscriptions/1ceef401-2164-4c69-8301-f06461c00e9b/resourceGroups/RG_CSVC_BASE_PRIVATE_NONPROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_NONPROD_AUE/subnets/SUBNET_INTEGRATION_KUBERNETES_KUBE-SHARED_NONPROD_AUE",\
"/subscriptions/889e3e4d-0562-4125-b2de-3bdf18ee7c09/resourceGroups/RG_Cloud_Services_Non-Production_AUE/providers/Microsoft.Network/virtualNetworks/VNET_CLOUD_SERVICES_PRIVATE_NONPRODUCTION_AUE/subnets/SUBNET_DEVOPS_AGENTS_PRIVATE_DEV_AUE",\
\
"/subscriptions/8dfb7356-39fe-47df-8c17-559bc009f82f/resourceGroups/RG_CSVC_BASE_PRIVATE_PROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_PROD_AUE/subnets/SUBNET_INTEGRATION_KUBE_KUBE-SHARED_PROD_AUE",\
    "/subscriptions/8dfb7356-39fe-47df-8c17-559bc009f82f/resourceGroups/RG_CSVC_BASE_PRIVATE_PROD_AUE/providers/Microsoft.Network/virtualNetworks/VNET_INTE_PRIVATE_PROD_AUE/subnets/SUBNET_INTEGRATION_KUBERNETES_KUBE-SHARED_PROD_AUE",\
\
"client_id": "aad259a0-faf8-4576-a024-89d217ffe2cf",\
\
"active_directory_admin_group_object_id": "8d721490-8a0c-4b05-98ba-84b942ff6278",\
\
\
I have assisted in SVT deployments and a change has been raised for PROD setup for today. I have started looking into it and progress on it today setting up IAC\
\
/subscriptions/49a47edd-fc88-441c-b12b-ad79d12883ee/resourceGroups/RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_PROD_AUE/providers/Microsoft.ManagedIdentity/userAssignedIdentities/UAI-AKS-DGXP-DGKB-AUE-PL-PROD\
\
\
UAI SIT = e6930b68-ec3d-4288-8911-d9731c7252d4\
UAI DEV = 042c69be-2242-42bd-a45b-b97a815d3c5a\
UAI SVT = \
UAI PROD = 876565ed-fe9e-4f4a-88ae-255afc6da3f7\
\
- env_name: dev # required\
        path: manifest/dev  # required\
        revision: master  # optional\
        pod-identity:\
          - resource_id: /subscriptions/5da8013f-6883-4e0b-8de5-90141e2a60df/resourcegroups/RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_DEV_AUE/providers/Microsoft.ManagedIdentity/userAssignedIdentities/UAI-AKS-DGXP-DGKB-NONPROD-AUE-PL-DEV\
            client_id: 2292e693-a8bb-4211-800e-2c205e4bd8ae\
            selector: ui-product-list-service-dev\
      - env_name: sit # required\
        path: manifest/sit  # required\
        revision: master  # optional\
        pod-identity:\
          - resource_id: /subscriptions/5da8013f-6883-4e0b-8de5-90141e2a60df/resourcegroups/RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_SIT_AUE/providers/Microsoft.ManagedIdentity/userAssignedIdentities/UAI-AKS-DGXP-DGKB-NONPROD-AUE-PL-SIT\
            client_id: 0b115879-526b-4b8d-a3f3-e0b683812752\
            selector: uai-product-list-service-sit\
\
\
\
SPN-Coles-PROD-Integration-MCS-PRODUCT-LIST-API\
\
\
az aks get-credentials --resource-group 
\f0\b RG_DIGITALEXPERIENCE_CUSTOMERSERVICES_PRODUCTLIST_DEV_AUE\

\f1\b0  --name <aks cluster name> --overwrite-existing --subscription <subscription>\
\
\
==========\
\
\
\
\pard\pardeftab560\slleading20\partightenfactor0

\f0\b \cf0 SPN-Coles-DEV-DigitalExperience-CSV-API-PRODUCT-LIST-SERVICE : client id: 6062bcd4-012b-467c-84c4-f414e65e1c3e\
\pard\pardeftab560\slleading20\partightenfactor0

\f1\b0 \cf0 \
\
\pard\pardeftab560\slleading20\partightenfactor0

\f0\b \cf0 SPN-Coles-SIT-DigitalExperience-CSV-API-PRODUCT-LIST-SERVICE : client id : 40e5723a-6037-4eec-9539-6481b2b33845\
\
SPN-Coles-SVT-DigitalExperience-CSV-API-PRODUCT-LIST-SERVICE : client id:  480e8df3-7b18-4e02-ad36-cfb577b0a59e\
\pard\pardeftab560\slleading20\partightenfactor0

\f1\b0 \cf0 \
\pard\pardeftab560\slleading20\partightenfactor0

\f0\b \cf0 SPN-Coles-PROD-DigitalExperience-CSV-API-PRODUCT-LIST-SERVICE :
\f1\b0   client id: 61e78b2b-cba9-43da-9e2e-3e8a9019d2b1\
\
\

\f0\b SPN-Coles-PROD-Integration-MCS-PRODUCT-LIST-API:
\f1\b0 \
\
\
\
\
\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
}